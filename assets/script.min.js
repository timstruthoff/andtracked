/*
┌─────┐
│ T M │ © 2017 - Tim Struthoff
│ S T │ 
└─────┘
*/
function OfflineNotification(){var e=document.createElement("div");e.classList="offline-notification";var t=document.createElement("div");t.classList="point";var n=document.createElement("div");return n.classList="text",n.innerHTML="Offline",e.appendChild(t),e.appendChild(n),document.body.appendChild(e),{online:function(){n.innerHTML="Online",e.classList="offline-notification online",setTimeout(function(){document.body.removeChild(e)},2400)}}}function offline(){return new Promise(function(e,t){var n=new OfflineNotification,o=setInterval(function(){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&!0===JSON.parse(t.responseText)&&(clearInterval(o),n.online(),e())},t.open("GET",passedVars.protocol+"://"+passedVars.hostname+"/api/status",!0),t.send()},1e3)})}function reloadEvents(){loadJson().then(function(e){events=events.concat(e.events),firstrender&&(openContainer.innerHTML="");for(var t in e.events)renderEvent(e.events[t]);firstrender&&(firstrender=!1),setTimeout(function(){reloadEvents()},e.nextRequest)}).catch(function(e){console.log(e),offline().then(function(){reloadEvents()})})}function timeSince(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3);return n>1?n+" years":1===n?"a year":(n=Math.floor(t/2592e3))>1?n+" months":1===n?"a month":(n=Math.floor(t/86400))>1?n+" days":1===n?"a day":(n=Math.floor(t/3600))>1?n+" hours":1===n?"an hour":(n=Math.floor(t/60))>1?n+" minutes":1===n?"a minute":(n=Math.floor(t),n>1?n+" seconds":"a second")}function renderEvent(e){console.log(e);var t=document.createElement("div");t.classList="open",firstrender||(t.classList="open animate");var n=document.createElement("div");n.classList="number",n.innerHTML="#"+e.number;var o=document.createElement("div");o.classList="text";var r=document.createElement("div");r.classList="time-ago";var i=new Date(e.timeAgo),a=timeSince(i);r.innerHTML=a+" ago",setInterval(function(){timeSince(i)!==a&&(a=timeSince(i),r.innerHTML=a+" ago")},1e3);var l=document.createElement("div");l.classList="other",l.innerHTML=e.text;var s=document.createElement("a");s.classList="details-link",s.href="/id-"+passedVars.trackId+"/"+(e.number-1),s.innerHTML="Details",o.appendChild(r),o.appendChild(l),o.appendChild(s),t.appendChild(n),t.appendChild(o),openContainer.insertBefore(t,openContainer.firstChild)}function loadJson(){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var t=JSON.parse(n.responseText);e(t)}},n.onerror=function(e){t(e)},n.open("GET",passedVars.protocol+"://"+passedVars.hostname+"/api/id-"+passedVars.trackId+"?offset="+events.length,!0),n.send()})}function openHelp(){helpOpen=!0,helpContainerEl.classList="instructions-long open",helpPEl.style.height="auto";var e=helpPEl.clientHeight;helpPEl.style.height=0,setTimeout(function(){helpPEl.style.height=e},1)}function closeHelp(){helpOpen=!1,localStorage.helpOnceClosed=!0,helpContainerEl.classList="instructions-long",helpPEl.style.height=0}function hasClass(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}var trackingImage=document.querySelector(".track-pixel");document.cookie="trackingPixelInactive=true",trackingImage.src=passedVars.trackUrl,trackingImage.onload=function(){console.log("loaded"),document.cookie="trackingPixelInactive=false"},trackingImage.onerror=function(){console.log("error"),document.cookie="trackingPixelInactive=false"};var redSquareMethodCopyButton=document.querySelector(".red-square-method .track-copy"),redSquareMethodTrackInput=document.querySelector(".red-square-method .track-input .input");redSquareMethodCopyButton.addEventListener("click",function(){var e=document.createRange();e.selectNodeContents(redSquareMethodTrackInput);var t=window.getSelection();t.removeAllRanges(),t.addRange(e);try{document.execCommand("copy")}catch(e){alert("Please press Ctrl/Cmd+C to copy")}});var htmlMethodCopyButton=document.querySelector(".html-method .track-copy"),htmlMethodTrackInput=document.querySelector(".html-method .input");htmlMethodCopyButton.addEventListener("click",function(){htmlMethodTrackInput.select();try{document.execCommand("copy")}catch(e){alert("Please press Ctrl/Cmd+C to copy")}});var firstrender=!0,openContainer=document.getElementById("opens"),events=[];reloadEvents();var helpOpen=!1,helpContainerEl=document.querySelector(".instructions-long"),helpAEl=document.querySelector(".instructions-long a"),helpPEl=document.querySelector(".instructions-long p");helpContainerEl.addEventListener("click",function(e){helpOpen?closeHelp():openHelp(),e.preventDefault()});var wasWindowBlurred=!1;window.addEventListener("blur",function(){wasWindowBlurred=!0}),setTimeout(function(){wasWindowBlurred||helpOpen||localStorage.helpOnceClosed||openHelp()},5e3);var otherClientLinkEl=document.querySelector(".other-client-link"),redSquareMethodContainerEl=document.querySelector(".red-square-method"),htmlMethodContainerEl=document.querySelector(".html-method"),currentMethodOpen="red-square";hasClass(htmlMethodContainerEl,"active")&&(currentMethodOpen="html"),otherClientLinkEl.addEventListener("click",function(e){if("red-square"===currentMethodOpen){currentMethodOpen="html",document.cookie="method=1",htmlMethodContainerEl.classList="html-method active";var t=htmlMethodContainerEl.clientHeight;htmlMethodContainerEl.style.height=0,setTimeout(function(){htmlMethodContainerEl.style.height=t},1),redSquareMethodContainerEl.style.height=redSquareMethodContainerEl.clientHeight,setTimeout(function(){redSquareMethodContainerEl.style.height="",redSquareMethodContainerEl.classList="red-square-method"},1),otherClientLinkEl.classList="other-client-link open"}else{currentMethodOpen="red-square",document.cookie="method=0",redSquareMethodContainerEl.classList="red-square-method active";var t=redSquareMethodContainerEl.clientHeight;redSquareMethodContainerEl.style.height=0,setTimeout(function(){redSquareMethodContainerEl.style.height=t},1),htmlMethodContainerEl.style.height=htmlMethodContainerEl.clientHeight,setTimeout(function(){htmlMethodContainerEl.style.height="",htmlMethodContainerEl.classList="html-method",setTimeout(function(){redSquareMethodContainerEl.style.height=""},400)},1),otherClientLinkEl.classList="other-client-link"}e.preventDefault()});